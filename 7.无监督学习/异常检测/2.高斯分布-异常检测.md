# 高斯分布（正态分布）

## 1. 高斯分布

![image-20240113164317284](C:\Users\chen\AppData\Roaming\Typora\typora-user-images\image-20240113164317284.png) 



高斯分布中的参数 $\mu$ 和 $\sigma$ 对高斯分布的影响：

![image-20240113164618467](C:\Users\chen\AppData\Roaming\Typora\typora-user-images\image-20240113164618467.png)



## 2. 将高斯分布应用于异常检测

当将**高斯分布**应用于异常检测时，给定一个包含 $m$ 个样本的训练集，则我们要做的是 **尝试估计训练集对于高斯分布的 平均参数$\mu$ 和 标准差参数$\sigma$**，如下图所示：

![image-20240113165034367](C:\Users\chen\AppData\Roaming\Typora\typora-user-images\image-20240113165034367.png)

给定一个新的测试样本，则可以通过估计的高斯分布的参数来计算该测试样本的概率密度，然后比较该概率密度和指定的阈值，判断该测试样本是否是异常样本。





## 3. 构建异常检测算法

### 3.1 概述

![image-20240113170055288](C:\Users\chen\AppData\Roaming\Typora\typora-user-images\image-20240113170055288.png)

有一个训练集 $\{\mathbf{x}^{(1)},\mathbf{x}^{(2)},...,\mathbf{x}^{(m)}\}$，每个样本都有 $n$ 个特征。

给定这个训练集，我们要做的是进行**密度估计**，这**意味着我们将建立一个模型或估计 $p(x)$ 的概率（建立概率密度函数）**；
$$
p(\mathbf{x})=p(x_1; \mu_1,\sigma_1^2) * p(x_2; \mu_2,\sigma_2^2)* ...*p(x_n; \mu_n,\sigma_n^2)
$$
**在统计学中，该等式成立的条件为 $x_1, x_2, ..., x_n$ 都必须是相互独立的特征，但事实证明，即使这些特征实际上并不是相互独立的，这个算法也能正常工作。**

要建立上述模型，则我们需要做的是对每个特征都进行高斯分布参数的估计，从而得到 $(\mu_1, \sigma_1^2), (\mu_2, \sigma_2^2), ..., (\mu_n, \sigma_n^2)$。

上述模型可以简写为：
$$
p(\mathbf{x}) = \prod_{j=1}^n p(x_j; \mu_j,\sigma_j^2)
$$

### 3.2 整体步骤

1. 选择可能指示异常样本的 $n$ 个特征；

2. **对每个特征都进行高斯分布的参数估计**，拟合数据得到参数 $(\mu_1, \sigma_1^2), (\mu_2, \sigma_2^2), ..., (\mu_n, \sigma_n^2)$，其中：

   - $$
     \mu_j=\frac{1}{m}\sum_{i=1}^m x_j^{(i)} \\
     \sigma_j^2 = \frac{1}{m} \sum_{i=1}^m (x_j^{(i)} - \mu_j)^2
     $$

   - 向量化计算的方式：

     - $$
       \mathbf{\mu} = \frac{1}{m} \sum_{i=1}^m \mathbf{x}^{(i)} \\
       $$

3. 给出一个新的测试样本 $x$，计算 $p(x)$：

   - $$
     p(x)=\prod_{j=1}^n p(x_j; \mu_j,\sigma_j^2) = \prod_{j=1}^n \frac{1}{\sqrt{2 \pi} \sigma_j} exp(- \frac{(x_j-\mu_j)^2}{2\sigma_j^2})
     $$

4. **将 $p(x)$ 与指定的阈值进行比较，判断其是否异常**



## 4. 开发与评估异常检测系统

### 4.1 使用交叉验证和测试集评估异常检测

![image-20240113174536559](C:\Users\chen\AppData\Roaming\Typora\typora-user-images\image-20240113174536559.png)

在开发学习算法时，如果我们有一种评估学习算法的方法，那么我们在做出决策时就会更加容易，比如选择不同的特征或尝试不同的参数值（例如阈值 $epsilon$），决定是否以某种方式更改特征或增加或减少 epsilon 或其他参数。

这有时被称为 **实数评估**，意思是如果我们能够以某种方式快速改变算法，例如改变一个特征或改变一个参数，并且有一种计算数字的方法可以告诉我们算法是好是坏，那么它将使得决定是否坚持对算法的改变 。



尽管我们主要讨论的是未标记数据，但是我们可以稍微改变以下这个假设，并假设我们有一些标记数据，通常包括少量以前观察到的异常（$y=0$ 表示正常样本，$y=1$ 表示异常样本）。

异常检测算法将从中学习的训练集仍然是 $x_1, x_2,...,x_m$ 的未标记训练集，我们将这些训练集的所有样本假设为正常（在事件中，可以有一些异常的例子在这个未标记训练集中，算法通常仍然可以正常工作）。

为例评估我们的算法，想出一种方法来进行 **实数评估**，如果我们有少量的异常样本，则会非常有用，因为这样我们就可以创建一个**交叉验证集**，表示为：
$$
(x_{cv}^{(1)}, y_{cv}^{(1)}),  (x_{cv}^{(2)}, y_{cv}^{(2)}),...,(x_{cv}^{(m)}, y_{cv}^{(m)})
$$
同样的，还可以创建有一些样本的**测试集**：
$$
(x_{test}^{(1)}, y_{test}^{(1)}),  (x_{test}^{(2)}, y_{test}^{(2)}),...,(x_{test}^{(m)}, y_{test}^{(m)})
$$
其中，**交叉验证集** 和 **测试集** 中都希望包含一些 **异常样本**，

> 同样，在实践中，如果有一些样本实际上是异常的，但意外地被标记为 $y=0$，则异常检测算法也仍然能够正常工作。



### 4.2 举例说明 `评估方法`

假设我们有10000个良好的发动机数据以及20个有缺陷或异常的发动机数据，则我们可以将此数据集分解为 `训练集、交叉验证集、测试集`，例如：

- 训练集：包含6000个正常的发动机样本（未标记数据）
- 交叉验证集：包含2000个正常的发动机样本以及10个异常的发动机样本（标记数据）
- 测试集：包含2000个正常的发动机样本以及10个异常的发动机样本（标记数据）

然后我们可以在训练集上训练算法，将高斯分布拟合到训练集的6000个样本上，然后再交叉验证集中运行算法，查看它正确标记了多少异常样本：

- 例如，我们可以使用交叉验证集来调整参数 $epsilon$ 并将其设置得更高或更低，取决于异常检测算法对异常样本的检测能力；

在使用交叉验证集调整完参数之后，可以使用测试集对算法进行评估，以评估其泛化能力。



**注意**：这仍然是一种无监督学习算法，因为训练集实际上没有标签。

事实证明，如果我们正在构建一个实用的异常检测系统，则使用包含少量的异常交叉验证集和测试集来评估以及调整算法非常有帮助。



由于含有异常的样本较少，没有足够的数据来创建与交叉验证集不同的完全独立的测试集，有时候也会使用另一种方法进行评估——即不使用测试集，而只使用交叉验证集来评估算法以及调整算法的参数，但不使用测试集的缺点是，在调整算法之后，我们没有公平的方法来判断它在未曾见过的数据上的泛化能力如何。但是当数据集很小的时候，特别是当有很小的异常样本时，这可能是最好的选择。如果是这种情况，请注意存在更高的风险，因为我们将围绕参数 $epsilon$ 做出的一些决策和特征选择等可能会过拟合交叉验证集，因此它在未来对真实数据的表现可能并不如预期的好。



### 4.3 如何在交叉验证集或测试集上实际评估算法

1. 首先我们将在训练集上训练模型以拟合训练数据；

2. 然后在交叉验证集或测试集上运行算法，计算样本的 $p(x)$，并判断其是否异常：

   - $$
     y=
     \begin{cases}
     1 & if & p(x) \lt \epsilon & (anomaly) \\
     0 & if & p(x) \ge \epsilon & (normaly)
     \end{cases}
     $$

   - 基于此，查看该算法对交叉验证集或测试集的预测与交叉验证集或测试集中的标签的匹配的准确程度；

   - 但是由于交叉验证集和测试集中的异常样本比正常样本少很多，所以交叉验证集和测试集中的数据是偏斜的，则不能仅仅使用 `准确率` 来评估算法的性能，而应该使用 `精确率、召回率、F1分数、ROC、AUC`等指标进行评估；

![image-20240113180709308](C:\Users\chen\AppData\Roaming\Typora\typora-user-images\image-20240113180709308.png)